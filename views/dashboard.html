<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pilgram Admin Dashboard</title>
  <link rel="stylesheet" href="/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-[#0f0f0f] text-white">
  <header class="flex justify-between items-center p-4 border-b border-gray-700">
    <img src="/logo1.png" alt="Logo" class="h-10">
    <a href="/logout" class="logout-btn">Logout</a>
  </header>

  <main class="p-4">
    <!-- Tabs -->
    <section class="tab-buttons flex gap-2 mb-4">
      <button class="tab-btn active" onclick="showTab('sales', this)">üí∞ Sales</button>
      <button class="tab-btn" onclick="showTab('behavior', this)">üë• User Behavior</button>
      <button class="tab-btn" onclick="showTab('traffic', this)">üåê Traffic</button>
    </section>

    <!-- üí∞ SALES TAB -->
    <div id="tab-sales" class="tab-content">
      <h2 class="text-green-400 text-xl font-bold mb-4">Sales Charts</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Sales Over Time -->
        <div class="bg-[#181818] rounded-2xl shadow p-4">
          <div class="flex justify-between items-center mb-2">
            <h3 class="text-white font-semibold">Sales Over Time</h3>
            <select id="salesChartType" class="tab-btn" onchange="updateSalesChartType(this.value)">
              <option value="line">Line</option>
              <option value="bar">Bar</option>
            </select>
          </div>
          <canvas id="salesOverTimeChart" height="200"></canvas>
        </div>

        <!-- Revenue Breakdown -->
        <div class="bg-[#181818] rounded-2xl shadow p-4">
          <div class="flex justify-between items-center mb-2">
            <h3 class="text-white font-semibold">Revenue Breakdown</h3>
            <select id="revenueChartType" class="tab-btn" onchange="updateRevenueChartType(this.value)">
              <option value="bar">Bar</option>
              <option value="line">Line</option>
            </select>
          </div>
          <canvas id="revenueChart" height="200"></canvas>
          <p id="revenueComparison" class="text-green-500 mt-2 text-sm"></p>
        </div>
      </div>

      <!-- Orders Table -->
      <div class="sorted-orders-container">
        <div class="flex justify-between items-center mb-2">
          <h2 class="sorted-orders-title">Sorted Orders</h2>
          <a href="/export/orders" class="export-btn">Export Orders</a>
        </div>
        <div class="overflow-x-auto">
          <table class="sorted-orders-table">
            <thead>
              <tr>
                <th>Email</th>
                <th>Product</th>
                <th>ID</th>
                <th>Time</th>
              </tr>
            </thead>
            <tbody id="orders"></tbody>
          </table>
          <div id="pagination" class="pagination-controls" style="margin-top: 1rem; text-align: center;"></div>
        </div>
      </div>
    </div>

    <!-- üë• USER BEHAVIOR TAB -->
    <div id="tab-behavior" class="tab-content hidden">
      <section class="stats-grid grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="card bg-[#181818] p-4 rounded-2xl shadow">
          <h2 class="text-white mb-1">Avg Scroll Depth</h2>
          <p id="scrollDepth" class="text-xl font-bold text-green-400">‚Äì</p>
        </div>
        <div class="card bg-[#181818] p-4 rounded-2xl shadow">
          <h2 class="text-white mb-1">Avg Clicks</h2>
          <p id="clicks" class="text-xl font-bold text-green-400">‚Äì</p>
        </div>
        <div class="card bg-[#181818] p-4 rounded-2xl shadow">
          <h2 class="text-white mb-1">Avg Time on Page (s)</h2>
          <p id="timeOnPage" class="text-xl font-bold text-green-400">‚Äì</p>
        </div>
      </section>
    </div>

    <!-- üåê TRAFFIC TAB -->
    <div id="tab-traffic" class="tab-content hidden">
      <section class="stats-grid grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="card bg-[#181818] p-4 rounded-2xl shadow">
          <h2 class="text-white mb-2">Top Countries</h2>
          <ul id="geoData" class="text-sm text-gray-300"></ul>
        </div>
        <div class="card bg-[#181818] p-4 rounded-2xl shadow">
          <h2 class="text-white mb-2">Devices</h2>
          <ul id="deviceData" class="text-sm text-gray-300"></ul>
        </div>
        <div class="card bg-[#181818] p-4 rounded-2xl shadow">
          <h2 class="text-white mb-2">Referrals</h2>
          <ul id="referralData" class="text-sm text-gray-300"></ul>
        </div>
      </section>

      <div class="bg-[#181818] rounded-2xl shadow p-4 mt-6">
        <div class="flex justify-between items-center mb-2">
          <h3 class="text-white font-semibold">Views Over Time</h3>
          <select id="homepageChartType" class="tab-btn" onchange="updateHomepageChartType(this.value)">
            <option value="line">Line</option>
            <option value="bar">Bar</option>
          </select>
        </div>
        <canvas id="homepageChart" height="200"></canvas>
      </div>
    </div>
  </main>

  <!-- Script block -->
  <script>
    function showTab(tabName, btn) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
      document.getElementById('tab-' + tabName).classList.remove('hidden');
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }

    function setupCharts() {
      // placeholder for chart logic
      console.log("Charts initialized");
    }

    setupCharts();
  </script>
  
  <script>
  const ordersPerPage = 10;
  let currentPage = 1;
  let allOrders = [];

  async function fetchOrders() {
    const res = await fetch('/api/shoppy/orders');
    allOrders = await res.json();
    renderOrders();
    renderPagination();
  }

  function renderOrders() {
    const start = (currentPage - 1) * ordersPerPage;
    const end = start + ordersPerPage;
    const visibleOrders = allOrders.slice(start, end);

    const ordersTable = document.getElementById('orders');
    ordersTable.innerHTML = visibleOrders.map(order => `
      <tr>
        <td>${order.email}</td>
        <td>${order.product_name}</td>
        <td>${order.product_id}</td>
        <td>${new Date(order.timestamp).toLocaleString()}</td>
      </tr>
    `).join('');
  }

  function renderPagination() {
    const totalPages = Math.ceil(allOrders.length / ordersPerPage);
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      if (i === currentPage) btn.classList.add('active');
      btn.addEventListener('click', () => {
        currentPage = i;
        renderOrders();
        renderPagination();
      });
      pagination.appendChild(btn);
    }
  }

  fetchOrders();
</script>

</body>
</html>

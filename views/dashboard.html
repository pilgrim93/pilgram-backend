<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CPAPilgrim Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: #121212; color: white; font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .nav-tabs { display: flex; background: #1e1e1e; padding: 10px; }
    .tab { background: #333; border: none; color: white; padding: 10px 20px; cursor: pointer; margin-right: 10px; }
    .tab.active { background: #555; }
    .tab-content { display: none; padding: 20px; }
    .tab-content.active { display: block; }
    canvas { max-width: 100%; height: 300px; background: white; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #444; padding: 8px; text-align: left; color: white; }
    th { background: #222; }
    select, button { margin-top: 10px; padding: 5px; background: #333; color: white; border: 1px solid #555; }
  </style>
</head>
<body>

  <!-- Nav Tabs -->
  <div class="nav-tabs">
    <button class="tab active" data-tab="sales-section">üí∞ Sales</button>
    <button class="tab" data-tab="user-section">üë• User Behavior</button>
    <button class="tab" data-tab="traffic-section">üåê Traffic</button>
  </div>

  <!-- Tab Contents -->
  <div id="sales-section" class="tab-content active">
    <h2>Sales Charts</h2>
    <canvas id="sales-chart"></canvas>
    <canvas id="revenue-chart"></canvas>
    <canvas id="conversion-chart"></canvas>
    <label>Conversion View:
      <select id="conversion-time-view">
        <option value="daily" selected>Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
      </select>
    </label>
  </div>

  <div id="user-section" class="tab-content">
    <h2>User Behavior</h2>
    <canvas id="sessions-chart"></canvas>
    <canvas id="users-chart"></canvas>
    <canvas id="engagement-chart"></canvas>
  </div>

  <div id="traffic-section" class="tab-content">
    <h2>Traffic</h2>
    <canvas id="traffic-time-chart"></canvas>
    <canvas id="traffic-sources-chart"></canvas>
  </div>

<script>
  const tabs = document.querySelectorAll(".tab");
  const contents = document.querySelectorAll(".tab-content");
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("active"));
      contents.forEach(c => c.classList.remove("active"));
      tab.classList.add("active");
      document.getElementById(tab.dataset.tab).classList.add("active");
    });
  });

  let salesChart, revenueChart, conversionChart, sessionChart, usersChart, engagementChart, trafficTimeChart, trafficSourcesChart;
  let salesData, revenueData, trafficData;

  const mockData = {
    sales: {
      labels: {
        daily: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        weekly: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
        monthly: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul']
      },
      daily: [5, 10, 7, 14, 9, 12, 6],
      weekly: [42, 38, 55, 47],
      monthly: [120, 145, 132, 165, 178, 155, 188],
      sessions: {
        daily: [20, 30, 25, 40, 35, 30, 28],
        weekly: [140, 130, 155, 145],
        monthly: [600, 700, 650, 750, 800, 720, 810]
      }
    },
    revenue: {
      product: {
        labels: ['Basic', 'Premium', 'Bundle'],
        data: [120, 240, 90]
      },
      category: {
        labels: ['Subscriptions', 'One-time', 'Upgrades'],
        data: [300, 200, 100]
      }
    },
    traffic: {
      overtime: {
        daily: [120, 140, 130, 150, 160, 145, 155],
        weekly: [700, 750, 800, 780],
        monthly: [3000, 3100, 3200, 3300, 3400, 3500, 3600]
      },
      sources: {
        all: {
          labels: ['Direct', 'Search', 'Social'],
          data: [45, 35, 20]
        },
        week: {
          labels: ['Direct', 'Search', 'Social'],
          data: [50, 30, 20]
        },
        month: {
          labels: ['Direct', 'Search', 'Social'],
          data: [55, 25, 20]
        }
      }
    }
  };

  async function fetchSalesData() {
    return mockData.sales;
  }

  async function fetchRevenueData() {
    return mockData.revenue;
  }

  async function fetchTrafficData() {
    return mockData.traffic;
  }

  function updateConversionChart(view = 'daily') {
    const sales = salesData[view];
    const sessions = salesData.sessions[view];
    const labels = salesData.labels[view];
    const conversionValues = sales.map((s, i) => ((s / (sessions[i] || 1)) * 100).toFixed(2));

    conversionChart.data.labels = labels;
    conversionChart.data.datasets[0].data = conversionValues;
    conversionChart.update();
  }

  async function crts() {
    salesData = await fetchSalesData();
    revenueData = await fetchRevenueData();
    trafficData = await fetchTrafficData();

    const commonOptions = {
      responsive: true,
      plugins: {
        legend: { labels: { color: 'white' } }
      },
      scales: {
        x: { ticks: { color: 'white' } },
        y: { ticks: { color: 'white' } }
      }
    };

    const salesCtx = document.getElementById('sales-chart').getContext('2d');
    salesChart = new Chart(salesCtx, {
      type: 'line',
      data: {
        labels: salesData.labels.daily,
        datasets: [{ label: 'Sales', data: salesData.daily, borderColor: 'cyan' }]
      },
      options: commonOptions
    });

    const revenueCtx = document.getElementById('revenue-chart').getContext('2d');
    revenueChart = new Chart(revenueCtx, {
      type: 'bar',
      data: {
        labels: revenueData.product.labels,
        datasets: [{ label: 'Revenue', data: revenueData.product.data, backgroundColor: 'green' }]
      },
      options: commonOptions
    });

    const convCtx = document.getElementById('conversion-chart').getContext('2d');
    const convValues = salesData.daily.map((s, i) => ((s / (salesData.sessions.daily[i] || 1)) * 100).toFixed(2));
    conversionChart = new Chart(convCtx, {
      type: 'line',
      data: {
        labels: salesData.labels.daily,
        datasets: [{ label: 'Conversion %', data: convValues, borderColor: 'gold' }]
      },
      options: commonOptions
    });

    const sessCtx = document.getElementById('sessions-chart').getContext('2d');
    sessionChart = new Chart(sessCtx, {
      type: 'line',
      data: {
        labels: salesData.labels.daily,
        datasets: [{ label: 'Sessions', data: salesData.sessions.daily, borderColor: 'orange' }]
      },
      options: commonOptions
    });

    const usersCtx = document.getElementById('users-chart').getContext('2d');
    usersChart = new Chart(usersCtx, {
      type: 'pie',
      data: {
        labels: ['New Users', 'Returning Users'],
        datasets: [{ data: [60, 40], backgroundColor: ['blue', 'purple'] }]
      }
    });

    const engageCtx = document.getElementById('engagement-chart').getContext('2d');
    engagementChart = new Chart(engageCtx, {
      type: 'bar',
      data: {
        labels: salesData.labels.daily,
        datasets: [{ label: 'Clicks per Session', data: [3, 4, 5, 3.5, 4.2, 4.8, 3.9], backgroundColor: 'lightblue' }]
      },
      options: commonOptions
    });

    const trafficTimeCtx = document.getElementById('traffic-time-chart').getContext('2d');
    trafficTimeChart = new Chart(trafficTimeCtx, {
      type: 'line',
      data: {
        labels: salesData.labels.daily,
        datasets: [{ label: 'Visitors', data: trafficData.overtime.daily, borderColor: 'magenta' }]
      },
      options: commonOptions
    });

    const sourceCtx = document.getElementById('traffic-sources-chart').getContext('2d');
    trafficSourcesChart = new Chart(sourceCtx, {
      type: 'doughnut',
      data: {
        labels: trafficData.sources.all.labels,
        datasets: [{ data: trafficData.sources.all.data, backgroundColor: ['red', 'green', 'blue'] }]
      },
      options: { plugins: { legend: { labels: { color: 'white' } } } }
    });

    updateConversionChart('daily');
  }

  document.addEventListener("DOMContentLoaded", async () => {
    await crts();

    document.getElementById('conversion-time-view').addEventListener('change', function () {
      updateConversionChart(this.value);
    });
  });
</script>
</body>
</html>
